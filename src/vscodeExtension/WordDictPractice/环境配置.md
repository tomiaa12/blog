# 环境变量配置指南

## 必需的环境变量

在项目根目录创建 `.env` 文件（或 `.env.local`），添加以下配置：

```env
# Firebase 配置
VITE_FIREBASE_API_KEY=your-firebase-api-key
VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your-project-id

# Google OAuth 配置（用于 VSCode 扩展登录）
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
VITE_GOOGLE_CLIENT_SECRET=your-client-secret

# OAuth 回调端口（可选，默认 5589）
VITE_GOOGLE_OAUTH_PORT=5589
```

## 获取配置值

### 1. Firebase 配置

1. 访问 [Firebase Console](https://console.firebase.google.com/)
2. 选择或创建项目
3. 进入项目设置 → 常规
4. 在"您的应用"部分，选择 Web 应用
5. 复制配置信息

### 2. Google OAuth 配置

1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 选择或创建项目（**必须与 Firebase 使用同一个项目**）
3. 启用 API：
   - 搜索并启用"Google+ API"或"Google Identity"
4. 创建凭据：
   - 左侧菜单：API 和服务 → 凭据
   - 点击"创建凭据" → "OAuth 2.0 客户端 ID"
   - 应用类型：**Web 应用**
   - 名称：`Word Dict VSCode Extension`（或自定义）
   - 已获授权的重定向 URI：添加 `http://localhost:5589/callback`
   - 点击"创建"
5. 记录生成的：
   - **客户端 ID**（复制到 `VITE_GOOGLE_CLIENT_ID`）
   - **客户端密钥**（复制到 `VITE_GOOGLE_CLIENT_SECRET`）

### 重要提示

- ⚠️ **Google Cloud 项目必须与 Firebase 项目一致**
- ⚠️ **不要将 `.env` 文件提交到 Git**
- ⚠️ **客户端密钥需要保密**

## 自定义端口

如果默认端口 5589 被占用，可以修改：

1. 更新 `.env` 文件：
```env
VITE_GOOGLE_OAUTH_PORT=5590
```

2. 在 Google Cloud Console 中更新重定向 URI：
```
http://localhost:5590/callback
```

## 测试配置

启动开发服务器后，在 VSCode 扩展中点击登录按钮：

1. 应该会在外部浏览器中打开 Google 授权页面
2. 授权后，浏览器会显示"登录成功"
3. VSCode 扩展中应该显示用户信息

如果失败，检查：
- 浏览器控制台的错误信息
- VSCode 开发者工具的控制台（帮助 → 切换开发人员工具）
- 端口是否被占用
- 环境变量是否正确加载

## 生产环境

在生产环境中（发布到 VSIX），建议：

1. 使用 VSCode Secret Storage API 存储敏感信息
2. 或者提示用户在扩展设置中输入凭据
3. 不要将密钥硬编码到代码中

### 使用 Secret Storage 示例

```typescript
// extension.js
async function getOAuthConfig(context) {
  const secrets = context.secrets
  
  let clientId = await secrets.get('google_client_id')
  let clientSecret = await secrets.get('google_client_secret')
  
  // 如果没有，提示用户输入
  if (!clientId) {
    clientId = await vscode.window.showInputBox({
      prompt: '请输入 Google OAuth Client ID',
      ignoreFocusOut: true
    })
    if (clientId) {
      await secrets.store('google_client_id', clientId)
    }
  }
  
  if (!clientSecret) {
    clientSecret = await vscode.window.showInputBox({
      prompt: '请输入 Google OAuth Client Secret',
      password: true,
      ignoreFocusOut: true
    })
    if (clientSecret) {
      await secrets.store('google_client_secret', clientSecret)
    }
  }
  
  return { clientId, clientSecret }
}
```

