<script setup>
import baiduMap from './components/baiduMap.vue'
</script>

# openlayers 6 加载百度地图瓦片(在线，离线)

## 前言

- 众所周知，`EPSG:4326`表示大地经纬度坐标，也叫`WGS84`坐标
- `EPSG:3857`则表示大地平面坐标，也叫墨卡托坐标，`openlayers`本身支持这两个坐标互相转换

- 而据我所知，国内使用的坐标都是做了偏移的，一般是西安80（EPSG:4610）、北京54（EPSG:2433）。
- 高德使用的是`GCJ-02`坐标，而百度则是再`GCJ-02`基础上做了偏移为`BD:09`坐标，一般知道坐标的编码使用`openlayers`就能互相转换，但是`GCJ-02`、`BD:09`都是通过算法加密了，需要我们手动使用算法完成转换

- 于是，已经有大佬早就写了库`npm i projzh`


## 示例

<ClientOnly>
  <baiduMap/>
</ClientOnly>

::: details 点击查看代码
<<< @/docs/框架/openlayers示例/地图控件/components/baiduMap.vue
:::

## 坐标转换实现

- 百度墨卡托坐标：百度的瓦片需要使用这个平面坐标系
```ts
const baiduMercator = new Projection({
  code: "baidu",
  extent: [-20022743.74356534, -12474104.1741364, 20022743.74356534, 12474104.1741364],
  // extent: [-20037726.37, -12474104.17, 20037726.37, 12474104.17],
  units: "m",
})
addProjection(baiduMercator)
addCoordinateTransforms(
  "EPSG:4326",
  baiduMercator,
  projzh.ll2bmerc,
  projzh.bmerc2ll
)
addCoordinateTransforms(
  "EPSG:3857",
  baiduMercator,
  projzh.smerc2bmerc,
  projzh.bmerc2smerc
)
```

- 百度经纬度坐标`BD:09`

你可以在[百度坐标拾取](https://api.map.baidu.com/lbsapi/getpoint/index.html)上取得的坐标是百度经纬度坐标

```ts
/* 百度 BD:09 经纬度坐标 */
const BD09 = new Projection({
  code: "BD:09",
  units: "m",
  extent: [-179.86541124,-74, 179.86541124,74]
})
addProjection(BD09)
addCoordinateTransforms(
  "EPSG:4326",
  BD09,
  (coordinate) => {
    return projzh.datum.bd09.fromWGS84(coordinate)
  },
  (coordinate) => {
    return projzh.datum.bd09.toWGS84(coordinate)
  },
)
addCoordinateTransforms(
  "EPSG:3857",
  BD09,
  (coordinate) => {
    const WWGS84 = transform(coordinate, "EPSG:3857", "EPSG:4326") // 转成84经纬度坐标
    return projzh.datum.bd09.fromWGS84(WWGS84) // 再转换成 BD 09
  },
  (coordinate) => {
    const WGS84 = projzh.datum.bd09.toWGS84(coordinate) // 转成84经纬度坐标
    return transform(WGS84, "EPSG:3857", "EPSG:4326") // 再转换成大地平面坐标
  },
)
```

- 百度墨卡托 BD:09 互转

```ts
/* 百度墨卡托 BD:09 互转 */
addCoordinateTransforms(
  BD09,
  baiduMercator,
  (coordinate) => {
    const WGS84 = projzh.datum.bd09.toWGS84(coordinate) 
    return  projzh.ll2bmerc(WGS84)
  },
  (coordinate) => {
    const WGS84 = projzh.bmerc2ll(coordinate)
    return projzh.datum.bd09.fromWGS84(WGS84)
  },
)
```

